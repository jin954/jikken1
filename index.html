<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>画像スライダーウィジェット</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="image-container" id="imageContainer">
        <img src="default_image.png" id="currentImage" class="image" alt="画像表示エリア">
    </div>
    <div class="control-buttons">
        <span class="triangle-button" onclick="prevImage()">&#9664;</span>
        <span class="triangle-button" onclick="openSettings()">&#9679;</span>
        <span class="triangle-button" onclick="nextImage()">&#9654;</span>
    </div>

    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeSettings()">&times;</span>
            <h2>設定</h2>

            <!-- アラーム設定 -->
            <div class="alarm-settings">
                <label>時間 : </label>
                <input type="time" id="alarmTime" class="input-time" value="00:00">
                <button id="saveAlarm" onclick="saveSettings()">保存</button>
                <button id="resetAlarm" style="display:none;" onclick="resetSettings()">リセット</button>
            </div>

            <br>

            <!-- 画像アップロードセクション -->
            <label for="uploadImage">画像 :</label>
            <div class="file-upload-container">
                <input type="file" id="uploadImage" accept="image/*" multiple style="display:none;" onchange="autoSaveImages()">
                <button type="button" onclick="document.getElementById('uploadImage').click()">ファイルを選択</button>
            </div>

            <br><br>

            <!-- 登録済み画像リスト -->
            <h3>登録済み画像</h3>
            <div id="imageListContainer">
                <div id="imageList"></div>
            </div>

            <br>
            <button class="close-button-bottom" onclick="closeSettings()">閉じる</button>
        </div>
    </div>

    <script>
        let currentIndex = 0;
        let images = JSON.parse(localStorage.getItem("images")) || [];

        // 設定画面を開く
        function openSettings() {
            document.getElementById("settingsModal").style.display = "block";
        }

        // 設定画面を閉じる
        function closeSettings() {
            document.getElementById("settingsModal").style.display = "none";
        }

        // アラーム設定を保存
        function saveSettings() {
            const alarmTime = document.getElementById("alarmTime").value;
            localStorage.setItem("alarmTime", alarmTime);
            document.getElementById("saveAlarm").textContent = "設定済み";
            document.getElementById("saveAlarm").disabled = true;
            document.getElementById("resetAlarm").style.display = "inline";
            document.getElementById("alarmTime").disabled = true; // アラーム設定後に時間入力を無効化
        }

        // アラーム設定をリセット
        function resetSettings() {
            localStorage.removeItem("alarmTime");
            document.getElementById("saveAlarm").textContent = "保存";
            document.getElementById("saveAlarm").disabled = false;
            document.getElementById("resetAlarm").style.display = "none";
            document.getElementById("alarmTime").disabled = false; // リセット後に時間入力を有効化
        }

        // 画像の登録
        function autoSaveImages() {
            const input = document.getElementById('uploadImage');
            const files = input.files;

            if (files.length > 0) {
                for (const file of files) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        const imageUrl = event.target.result;
                        registerImage(imageUrl);
                    };
                    reader.readAsDataURL(file);
                }
                input.value = ''; // ファイル選択をクリア
            }
        }

        // 画像リストを更新
        function registerImage(imageUrl) {
            images.push({ url: imageUrl });
            localStorage.setItem("images", JSON.stringify(images));
            updateImageList();
        }

        // 画像リストの表示
        function updateImageList() {
            const imageList = document.getElementById('imageList');
            imageList.innerHTML = ''; // リストをクリア
            images.forEach((image, index) => {
                const img = document.createElement('img');
                img.src = image.url;
                img.width = 50;
                img.height = 50;
                imageList.appendChild(img);
            });
        }

        // ページをロードしたときの処理
        window.onload = function () {
            currentIndex = parseInt(localStorage.getItem("currentIndex")) || 0;
            const savedAlarmTime = localStorage.getItem("alarmTime");
            const alarmInput = document.getElementById("alarmTime");

            if (savedAlarmTime) {
                alarmInput.value = savedAlarmTime;
                alarmInput.disabled = true; // アラームが設定済みなら無効化
                document.getElementById("saveAlarm").textContent = "設定済み";
                document.getElementById("saveAlarm").disabled = true;
                document.getElementById("resetAlarm").style.display = "inline";
            }

            updateImageList(); // 画像リストの初期表示
        };
    </script>
</body>
</html>
